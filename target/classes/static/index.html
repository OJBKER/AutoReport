<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Spring Boot + Vue 示例</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <!-- 在 Vue CDN 下面引入 Pinia CDN -->
    <script src="https://unpkg.com/pinia@2.0.14/dist/pinia.iife.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        #app { max-width: 400px; margin: auto; padding: 20px; border: 1px solid #eee; border-radius: 8px; }
        button { margin-top: 10px; }
    </style>
</head>
<body>
<div id="app">
    <h2>姓名提交演示</h2>
    <form @submit.prevent="submit">
        <label>姓名：<input v-model="name" required></label>
        <button type="submit">提交</button>
    </form>
    <div v-if="msg" style="margin-top:10px;color:green;">{{ msg }}</div>
    <h3 style="margin-top:30px;">已提交姓名列表：</h3>
    <ul>
        <li v-for="item in names" :key="item">{{ item }}</li>
    </ul>
</div>
<script>
const { createApp } = Vue;
const { createPinia, defineStore } = Pinia;

// 定义一个 Pinia store
const useNameStore = defineStore('nameStore', {
    state: () => ({
        names: []
    }),
    actions: {
        setNames(list) {
            this.names = list;
        },
        async fetchNames() {
            const res = await fetch('/api/names');
            this.names = await res.json();
        },
        async addName(name) {
            const res = await fetch('/api/names', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            });
            this.names = await res.json();
        }
    }
});

const app = createApp({
    data() {
        return {
            name: '',
            msg: ''
        }
    },
    computed: {
        // 让组件响应 Pinia store 的 names
        names() {
            return this.nameStore.names;
        }
    },
    mounted() {
        this.nameStore.fetchNames();
    },
    methods: {
        async submit() {
            await this.nameStore.addName(this.name);
            this.msg = '提交成功！';
            this.name = '';
        }
    },
    // 在 setup 里获取 store 实例
    setup() {
        const nameStore = useNameStore();
        return { nameStore };
    }
});

app.use(createPinia());
app.mount('#app');
</script>
</body>
</html>
